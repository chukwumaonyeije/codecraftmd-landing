<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome to CodeCraftMD - 2 Weeks FREE</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script>
    // Get campaign parameter from URL
    const urlParams = new URLSearchParams(window.location.search);
    const campaign = urlParams.get('campaign') || 'general';
    let offerCode = '';
    
    // Track visit on page load
    fetch('/api/outreach?campaign=' + campaign)
      .then(function(res) { return res.json(); })
      .then(function(data) {
        if (data.success) {
          offerCode = data.offerCode;
        }
      })
      .catch(function(err) { console.error('Error tracking visit:', err); });
    
    // State
    let formData = { name: '', email: '', phone: '' };
    let isSubmitting = false;
    let submitMessage = '';
    let isSuccess = false;
    
    // Render function
    function render() {
      const root = document.getElementById('root');
      root.innerHTML = '<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">' +
        '<div class="max-w-2xl w-full bg-white rounded-2xl shadow-2xl overflow-hidden">' +
          '<div class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-8 text-center">' +
            '<h1 class="text-4xl font-bold mb-2">Welcome to CodeCraftMD</h1>' +
            '<p class="text-xl opacity-90">AI-Powered Medical Billing Made Simple</p>' +
          '</div>' +
          '<div class="p-8">' +
            (isSuccess ? getSuccessHTML() : getFormHTML()) +
          '</div>' +
          '<div class="bg-gray-50 px-8 py-6 text-center text-sm text-gray-600">' +
            '<p>Questions? Contact us at <a href="mailto:support@codecraftmd.com" class="text-blue-600 hover:underline">support@codecraftmd.com</a></p>' +
          '</div>' +
        '</div>' +
      '</div>';
      
      if (!isSuccess) {
        attachFormHandlers();
      }
    }
    
    function getFormHTML() {
      return '<div class="bg-yellow-50 border-2 border-yellow-400 rounded-lg p-6 mb-8 text-center">' +
        '<div class="text-yellow-800 text-sm font-semibold uppercase tracking-wide mb-2">Exclusive Offer</div>' +
        '<div class="text-4xl font-bold text-yellow-900 mb-2">2 Weeks FREE</div>' +
        '<p class="text-gray-700 text-lg">No credit card required â€¢ Cancel anytime</p>' +
        (campaign !== 'general' ? '<div class="mt-4 text-sm text-gray-600">Campaign: <span class="font-mono font-semibold">' + campaign + '</span></div>' : '') +
      '</div>' +
      '<div class="mb-8"><h2 class="text-2xl font-bold text-gray-800 mb-4">Why CodeCraftMD?</h2><ul class="space-y-3">' +
        '<li class="flex items-start"><svg class="w-6 h-6 text-green-500 mr-3 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg><span class="text-gray-700">AI-powered ICD-10 and CPT code extraction</span></li>' +
        '<li class="flex items-start"><svg class="w-6 h-6 text-green-500 mr-3 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg><span class="text-gray-700">HIPAA-compliant and secure storage</span></li>' +
        '<li class="flex items-start"><svg class="w-6 h-6 text-green-500 mr-3 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg><span class="text-gray-700">Save hours on billing and reduce errors</span></li>' +
        '<li class="flex items-start"><svg class="w-6 h-6 text-green-500 mr-3 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg><span class="text-gray-700">Automated medical necessity narratives</span></li>' +
      '</ul></div>' +
      '<form id="signupForm" class="space-y-4">' +
        '<div><label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label><input type="text" id="name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Dr. Jane Smith" /></div>' +
        '<div><label class="block text-sm font-medium text-gray-700 mb-1">Email Address <span class="text-red-500">*</span></label><input type="email" id="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="doctor@example.com" /></div>' +
        '<div><label class="block text-sm font-medium text-gray-700 mb-1">Phone Number (Optional)</label><input type="tel" id="phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="(555) 123-4567" /></div>' +
        '<button type="submit" ' + (isSubmitting ? 'disabled' : '') + ' class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 text-white font-semibold py-4 rounded-lg hover:from-blue-700 hover:to-indigo-800 transition disabled:opacity-50 text-lg">' +
          (isSubmitting ? 'Processing...' : 'Start My Free Trial') +
        '</button>' +
      '</form>' +
      (submitMessage && !isSuccess ? '<div class="mt-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700 text-center">' + submitMessage + '</div>' : '');
    }
    
    function getSuccessHTML() {
      return '<div class="text-center py-8">' +
        '<div class="mb-6"><svg class="w-20 h-20 text-green-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div>' +
        '<h2 class="text-3xl font-bold text-gray-800 mb-4">Welcome to CodeCraftMD!</h2>' +
        '<p class="text-lg text-gray-600 mb-6">' + submitMessage + '</p>' +
        '<div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-6">' +
          '<div class="text-sm font-semibold text-blue-800 uppercase mb-2">Your Offer Code</div>' +
          '<div class="text-3xl font-mono font-bold text-blue-900">' + offerCode + '</div>' +
          '<p class="text-sm text-gray-600 mt-2">Save this code for your records</p>' +
        '</div>' +
        '<div class="space-y-4">' +
          '<p class="text-gray-700">Check your email for login instructions.</p>' +
          '<a href="/dashboard" class="inline-block bg-gradient-to-r from-blue-600 to-indigo-700 text-white font-semibold px-8 py-3 rounded-lg hover:from-blue-700 hover:to-indigo-800 transition">Go to Dashboard</a>' +
        '</div>' +
      '</div>';
    }
    
    function attachFormHandlers() {
      const form = document.getElementById('signupForm');
      if (form) {
        form.addEventListener('submit', handleSubmit);
      }
    }
    
    function handleSubmit(e) {
      e.preventDefault();
      isSubmitting = true;
      submitMessage = '';
      
      formData.name = document.getElementById('name').value;
      formData.email = document.getElementById('email').value;
      formData.phone = document.getElementById('phone').value;
      
      render();
      
      fetch('/api/outreach', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: formData.name, email: formData.email, phone: formData.phone, campaign: campaign })
      })
      .then(function(res) { return res.json(); })
      .then(function(data) {
        if (data.success) {
          isSuccess = true;
          submitMessage = data.message;
          offerCode = data.offerCode;
        } else {
          submitMessage = data.error || 'Something went wrong.';
        }
        isSubmitting = false;
        render();
      })
      .catch(function() {
        submitMessage = 'Network error. Please try again.';
        isSubmitting = false;
        render();
      });
    }
    
    // Initial render
    render();
  </script>
</body>
</html>
