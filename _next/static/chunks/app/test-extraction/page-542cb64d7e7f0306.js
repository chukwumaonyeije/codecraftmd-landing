(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[879],{6835:function(e,s,t){Promise.resolve().then(t.bind(t,6721))},6721:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return l}});var n=t(7437),a=t(2265);function i(e){let{onExtractComplete:s,onError:t}=e,[i,r]=(0,a.useState)(""),[l,o]=(0,a.useState)(!1),[c,d]=(0,a.useState)([]),[m,u]=(0,a.useState)(null),[h,x]=(0,a.useState)(0),g=async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;o(!0),u(null);try{let t=await fetch("/api/extract-codes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clinicalNote:e})}),a=await t.json();if(!a.success){if("RATE_LIMIT"===a.code&&n<2){let s=a.retryAfter||60;u("Rate limit exceeded. Retrying in ".concat(s," seconds...")),setTimeout(()=>{x(n+1),g(e,n+1)},1e3*s);return}throw Error(a.error)}d(a.diagnoses),x(0),null==s||s(a.diagnoses)}catch(s){let e=s instanceof Error?s.message:"An unexpected error occurred";u(e),null==t||t(e)}finally{o(!1)}},p=e=>"primary"===e?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800",y=e=>{switch(e){case"confirmed":return"bg-green-100 text-green-800";case"suspected":return"bg-yellow-100 text-yellow-800";case"rule_out":return"bg-red-100 text-red-800";case"history_of":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},b=e=>e>=.8?"text-green-600":e>=.6?"text-yellow-600":"text-red-600";return(0,n.jsxs)("div",{className:"w-full max-w-4xl mx-auto p-6 space-y-6",children:[(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"ICD-10 Code Extraction"}),(0,n.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!i.trim()){u("Please enter a clinical note");return}if(i.length>5e4){u("Clinical note exceeds maximum length of 50,000 characters");return}g(i)},className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"clinical-note",className:"block text-sm font-medium text-gray-700 mb-2",children:"Clinical Note"}),(0,n.jsx)("textarea",{id:"clinical-note",value:i,onChange:e=>r(e.target.value),placeholder:"Enter the clinical note for ICD-10 code extraction...",className:"w-full h-40 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-vertical",disabled:l}),(0,n.jsxs)("div",{className:"mt-1 text-sm text-gray-500",children:[i.length.toLocaleString()," / 50,000 characters"]})]}),(0,n.jsx)("button",{type:"submit",disabled:l||!i.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:l?(0,n.jsxs)("span",{className:"flex items-center",children:[(0,n.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Extracting Codes...",h>0&&" (Retry ".concat(h,")")]}):"Extract ICD-10 Codes"})]}),m&&(0,n.jsx)("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-md",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,n.jsxs)("div",{className:"ml-3",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,n.jsx)("div",{className:"mt-2 text-sm text-red-700",children:m})]})]})})]}),c.length>0&&(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,n.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Extracted Diagnoses (",c.length,")"]}),(0,n.jsx)("div",{className:"space-y-4",children:c.map((e,s)=>(0,n.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-sm transition-shadow",children:[(0,n.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,n.jsx)("code",{className:"text-lg font-mono font-semibold text-blue-700 bg-blue-50 px-2 py-1 rounded",children:e.code}),(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(p(e.priority)),children:e.priority}),(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(y(e.status)),children:e.status.replace("_"," ")})]}),(0,n.jsx)("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:e.description})]}),(0,n.jsx)("div",{className:"text-right",children:(0,n.jsxs)("div",{className:"text-sm font-medium ".concat(b(e.confidence)),children:[(100*e.confidence).toFixed(0),"% confidence"]})})]}),(0,n.jsxs)("div",{className:"bg-gray-50 p-3 rounded-md",children:[(0,n.jsx)("h5",{className:"text-sm font-medium text-gray-700 mb-1",children:"Supporting Evidence:"}),(0,n.jsxs)("p",{className:"text-sm text-gray-600 italic",children:['"',e.evidence,'"']})]})]},s))}),(0,n.jsx)("div",{className:"mt-6 p-4 bg-blue-50 rounded-md",children:(0,n.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,n.jsx)("strong",{children:"Note:"})," These codes are AI-generated suggestions. Always review and verify all diagnoses against clinical documentation and coding guidelines before use."]})})]})]})}let r={hypertension:"Chief Complaint: High blood pressure check\n  \nHistory of Present Illness:\n58-year-old male presents for routine blood pressure monitoring. Patient reports intermittent headaches and occasional dizziness. Blood pressure readings at home have been elevated (150-160/90-95 mmHg) over the past 2 weeks.\n\nPhysical Examination:\n- Vital Signs: BP 162/94 mmHg, HR 78 bpm, Temp 98.6\xb0F\n- HEENT: Normal\n- Cardiovascular: Regular rate and rhythm, no murmurs\n- Lungs: Clear bilaterally\n\nAssessment & Plan:\n- Essential hypertension - Continue current antihypertensive therapy\n- Follow up in 4 weeks",diabetes:"Chief Complaint: Diabetes follow-up\n\nHistory of Present Illness:\n45-year-old female with Type 2 diabetes mellitus presents for routine diabetes management. Patient reports good adherence to metformin. Recent HbA1c was 8.2%. Denies polyuria, polydipsia, or recent weight changes.\n\nPhysical Examination:\n- Vital Signs: BP 128/82 mmHg, BMI 32\n- Feet: No ulcers, good circulation\n- Eyes: Diabetic retinopathy screening due\n\nLaboratory Results:\n- HbA1c: 8.2% (target <7%)\n- Fasting glucose: 145 mg/dL\n\nAssessment & Plan:\n- Type 2 diabetes mellitus with poor glycemic control\n- Increase metformin dose and add glipizide\n- Diabetic retinopathy screening scheduled",complex:"Chief Complaint: Chest pain and shortness of breath\n\nHistory of Present Illness:\n72-year-old male with history of hypertension and coronary artery disease presents with acute onset chest pain and dyspnea. Pain started 2 hours ago, described as crushing substernal pain radiating to left arm. Associated with diaphoresis and nausea.\n\nPast Medical History:\n- Essential hypertension\n- Coronary artery disease\n- Previous myocardial infarction (2019)\n- Type 2 diabetes mellitus\n\nPhysical Examination:\n- Vital Signs: BP 180/100 mmHg, HR 110 bpm, RR 24, O2 sat 92% on room air\n- Cardiovascular: Tachycardic, S3 gallop present\n- Pulmonary: Bilateral crackles in lower lobes\n- Extremities: No edema\n\nECG: ST-elevation in leads II, III, aVF consistent with inferior STEMI\n\nLaboratory:\n- Troponin I: 15.2 ng/mL (elevated)\n- BNP: 850 pg/mL (elevated)\n\nAssessment & Plan:\n- Acute ST-elevation myocardial infarction (STEMI) - inferior wall\n- Acute heart failure with pulmonary edema\n- Hypertensive crisis\n- Background diabetes mellitus and coronary artery disease\n- Emergent cardiac catheterization indicated",suspected:"Chief Complaint: Joint pain and stiffness\n\nHistory of Present Illness:\n55-year-old female presents with 6-month history of bilateral hand and wrist pain and morning stiffness lasting >1 hour. Pain is worse in the morning and improves with activity. Patient also reports fatigue and occasional low-grade fever.\n\nPhysical Examination:\n- Joints: Bilateral MCP and PIP joint swelling and tenderness\n- Morning stiffness >1 hour\n- No obvious joint deformities yet\n\nLaboratory:\n- RF: Positive (1:320)\n- Anti-CCP: Positive (high titer)\n- ESR: 45 mm/hr (elevated)\n- CRP: 15 mg/L (elevated)\n\nAssessment & Plan:\n- Probable rheumatoid arthritis - refer to rheumatology\n- Rule out other inflammatory arthropathies\n- Start NSAIDs for symptom management\n- Rheumatology consultation scheduled"};function l(){let[e,s]=(0,a.useState)(""),[t,l]=(0,a.useState)([]),[o,c]=(0,a.useState)([]),d=e=>{s(r[e])};return(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,n.jsxs)("div",{className:"max-w-6xl mx-auto px-4",children:[(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"\uD83E\uDDEA ICD-10 Extraction Test Suite"}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:"Test the structured output functionality before merging to main branch"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Sample Clinical Notes"}),(0,n.jsx)("div",{className:"space-y-2",children:Object.entries(r).map(e=>{let[s,t]=e;return(0,n.jsxs)("button",{onClick:()=>d(s),className:"block w-full text-left p-3 bg-blue-50 hover:bg-blue-100 rounded-md border border-blue-200",children:[(0,n.jsx)("div",{className:"font-medium capitalize text-blue-800",children:s.replace(/([A-Z])/g," $1")}),(0,n.jsx)("div",{className:"text-sm text-blue-600 truncate",children:t.split("\\n")[0]})]},s)})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Test Results"}),(0,n.jsx)("div",{className:"bg-gray-900 text-green-400 p-4 rounded-md font-mono text-sm h-64 overflow-y-auto",children:o.length>0?o.map((e,s)=>(0,n.jsx)("div",{children:e},s)):(0,n.jsx)("div",{className:"text-gray-500",children:"No test results yet..."})}),(0,n.jsxs)("div",{className:"mt-4 space-x-2",children:[t.length>0&&(0,n.jsx)("button",{onClick:()=>{c([]);let e=[{name:"ICD-10 Code Format",check:e=>e.every(e=>/^[A-TV-Z][0-9][0-9AB](\.[0-9A-TV-Z]{1,4})?$/.test(e.code))},{name:"Required Fields Present",check:e=>e.every(e=>e.code&&e.description&&e.evidence&&e.priority&&e.status)},{name:"Confidence Range Valid",check:e=>e.every(e=>e.confidence>=0&&e.confidence<=1)},{name:"Priority Values Valid",check:e=>e.every(e=>["primary","secondary"].includes(e.priority))},{name:"Status Values Valid",check:e=>e.every(e=>["confirmed","suspected","rule_out","history_of"].includes(e.status))}].map(e=>{let s=e.check(t);return"".concat(s?"✅":"❌"," ").concat(e.name,": ").concat(s?"PASS":"FAIL")});c(s=>[...s,"--- Validation Tests ---",...e])},className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Run Validation Tests"}),(0,n.jsx)("button",{onClick:()=>{c([]),l([])},className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Clear Results"})]})]})]}),e&&(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Selected Clinical Note"}),(0,n.jsx)("div",{className:"bg-gray-50 p-4 rounded-md border max-h-40 overflow-y-auto",children:(0,n.jsx)("pre",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:e})})]})]}),(0,n.jsx)(i,{onExtractComplete:e=>{l(e);let s="✅ Successfully extracted ".concat(e.length," diagnoses");c(e=>[...e,s])},onError:e=>{let s="❌ Error: ".concat(e);c(e=>[...e,s])}}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mt-8",children:[(0,n.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"\uD83D\uDD27 Manual API Testing"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Test API Directly"}),(0,n.jsxs)("code",{className:"block bg-gray-100 p-3 rounded text-sm",children:["POST /api/extract-codes",(0,n.jsx)("br",{}),"Content-Type: application/json",(0,n.jsx)("br",{}),(0,n.jsx)("br",{}),JSON.stringify({clinicalNote:"Patient presents with..."},null,2)]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Expected Response"}),(0,n.jsx)("code",{className:"block bg-gray-100 p-3 rounded text-sm",children:JSON.stringify({success:!0,diagnoses:[{code:"I10",description:"Essential hypertension",confidence:.95,evidence:"Blood pressure 160/90 mmHg",priority:"primary",status:"confirmed"}],timestamp:"2024-01-20T12:00:00Z",model:"gpt-4o"},null,2)})]})]})]}),(0,n.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-6",children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-yellow-800 mb-2",children:"⚠️ Environment Setup Required"}),(0,n.jsxs)("ul",{className:"text-yellow-700 space-y-1",children:[(0,n.jsxs)("li",{children:["• Ensure ",(0,n.jsx)("code",{children:"OPENAI_API_KEY"})," is set in your environment variables"]}),(0,n.jsxs)("li",{children:["• Install required dependencies: ",(0,n.jsx)("code",{children:"npm install openai"})]}),(0,n.jsx)("li",{children:"• For Firebase functions: Update the functions directory as well"})]})]})]})})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=6835)}),_N_E=e.O()}]);